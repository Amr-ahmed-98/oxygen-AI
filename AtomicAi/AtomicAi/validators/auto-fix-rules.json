{
  "version": "1.0.0",
  "description": "Auto-fix rules for common validator errors",
  "rules": [
    {
      "id": "MOBILE_WIDE_TABLE",
      "code": "MOBILE_WIDE_TABLE",
      "description": "Replace wide table with card list + filter sheet on mobile",
      "patches": [
        {
          "op": "replace",
          "path": "{{screenPath}}/view/mobile/layout",
          "value": "cardList"
        },
        {
          "op": "add",
          "path": "{{screenPath}}/view/mobile/filters",
          "value": "bottomSheet"
        },
        {
          "op": "add",
          "path": "{{screenPath}}/view/mobile/virtualized",
          "value": true
        }
      ]
    },
    {
      "id": "LIST_HAS_STATES",
      "code": "MISSING_STATES",
      "description": "Add required states to list screen",
      "condition": {
        "screenType": "list"
      },
      "patches": [
        {
          "op": "add",
          "path": "{{screenPath}}/states",
          "value": {
            "loading": true,
            "empty": true,
            "error": true,
            "noPermission": true
          }
        }
      ]
    },
    {
      "id": "LIST_HAS_PAGINATION",
      "code": "MISSING_PAGINATION",
      "description": "Add pagination to list screens (web/desktop)",
      "condition": {
        "screenType": "list",
        "platform": ["web", "desktop"]
      },
      "patches": [
        {
          "op": "add",
          "path": "{{screenPath}}/view/web/pagination",
          "value": "server"
        },
        {
          "op": "add",
          "path": "{{screenPath}}/view/desktop/pagination",
          "value": "server"
        }
      ]
    },
    {
      "id": "ACTION_HAS_PERMISSION",
      "code": "MISSING_ACTION_PERMISSION",
      "description": "Infer permission from entity + action",
      "patches": [
        {
          "op": "add",
          "path": "{{screenPath}}/actionsPermissions",
          "value": {
            "create": "{{entity}}.create",
            "edit": "{{entity}}.edit",
            "delete": "{{entity}}.delete",
            "view": "{{entity}}.view"
          }
        }
      ]
    },
    {
      "id": "SCREEN_PERMISSIONS_DECLARED",
      "code": "MISSING_ROUTE_PERMISSION",
      "description": "Add permissions required for screen",
      "patches": [
        {
          "op": "add",
          "path": "{{screenPath}}/permissionsRequired",
          "value": ["{{entity}}.view"]
        }
      ]
    },
    {
      "id": "FORM_HAS_SUBMIT_STATES",
      "code": "MISSING_FORM_STATES",
      "description": "Add form submit states",
      "condition": {
        "screenType": ["create", "edit"]
      },
      "patches": [
        {
          "op": "add",
          "path": "{{screenPath}}/formStates",
          "value": {
            "idle": true,
            "submitting": true,
            "success": true,
            "error": true
          }
        }
      ]
    },
    {
      "id": "FORM_HAS_VALIDATION",
      "code": "MISSING_REQUIRED_FIELD_VALIDATION",
      "description": "Add schema-driven validation for forms",
      "condition": {
        "screenType": ["create", "edit"]
      },
      "patches": [
        {
          "op": "add",
          "path": "{{screenPath}}/validationMode",
          "value": "schemaDriven"
        }
      ]
    },
    {
      "id": "DESTRUCTIVE_CONFIRM",
      "code": "MISSING_DESTRUCTIVE_CONFIRM",
      "description": "Add confirmation for destructive actions",
      "condition": {
        "actionType": "destructive"
      },
      "patches": [
        {
          "op": "add",
          "path": "{{actionPath}}/confirm",
          "value": {
            "title": "تأكيد الحذف",
            "message": "هل أنت متأكد من الحذف؟"
          }
        }
      ]
    },
    {
      "id": "LONG_FORM_MOBILE_STEPPER",
      "code": "MOBILE_LONG_FORM_NO_STEPPER",
      "description": "Use stepper layout for long forms on mobile",
      "condition": {
        "screenType": ["create", "edit"],
        "platform": "mobile",
        "fieldCount": { "$gt": 10 }
      },
      "patches": [
        {
          "op": "add",
          "path": "{{screenPath}}/view/mobile/formLayout",
          "value": "stepper"
        }
      ]
    },
    {
      "id": "RTL_SAFE_LAYOUT",
      "code": "MISSING_LOGICAL_SPACING",
      "description": "Add RTL support",
      "condition": {
        "appLocale": { "$rtl": true }
      },
      "patches": [
        {
          "op": "add",
          "path": "/app/locale/rtl",
          "value": true
        },
        {
          "op": "add",
          "path": "/app/layoutDirection",
          "value": "rtl"
        }
      ]
    },
    {
      "id": "NO_EXTERNAL_CDN_ONPREM",
      "code": "EXTERNAL_CDN_ONPREM",
      "description": "Disable external CDN for on-premise",
      "condition": {
        "deliveryMode": "onPremise"
      },
      "patches": [
        {
          "op": "add",
          "path": "/delivery/assetsPolicy",
          "value": "localOnly"
        },
        {
          "op": "add",
          "path": "/delivery/noExternalCDN",
          "value": true
        }
      ]
    },
    {
      "id": "PERF_VIRTUALIZE_LONG_LISTS",
      "code": "MISSING_VIRTUALIZATION",
      "description": "Enable virtualization for long lists",
      "condition": {
        "screenType": "list"
      },
      "patches": [
        {
          "op": "add",
          "path": "{{screenPath}}/view/mobile/virtualized",
          "value": true
        },
        {
          "op": "add",
          "path": "{{screenPath}}/view/web/virtualized",
          "value": true
        },
        {
          "op": "add",
          "path": "{{screenPath}}/view/desktop/virtualized",
          "value": true
        }
      ]
    }
  ],
  "placeholders": {
    "{{screenPath}}": "Path to screen in spec (e.g., /screens/screen.ticket.list)",
    "{{entity}}": "Entity name (e.g., 'ticket', 'invoice')",
    "{{actionPath}}": "Path to action (e.g., /screens/screen.ticket.list/actions/0)"
  }
}

